WITH sums_and_counts AS (
    SELECT 
        Region,
        COUNT(*) AS n,
        SUM(`Unit Price`) AS sum_x,
        SUM(`Total Revenue`) AS sum_y,
        SUM(`Unit Price` * `Total Revenue`) AS sum_xy,
        SUM(POWER(`Unit Price`, 2)) AS sum_x2,
        SUM(POWER(`Total Revenue`, 2)) AS sum_y2
    FROM online_sales_data
    GROUP BY Region
)
SELECT 
    Region,
    (n * sum_xy - sum_x * sum_y) / 
    SQRT((n * sum_x2 - POWER(sum_x, 2)) * (n * sum_y2 - POWER(sum_y, 2))) AS correlation
FROM sums_and_counts;
